<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minimal API Test</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    pre {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    button {
      padding: 8px 16px;
      background-color: #4a90e2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    .loading {
      color: #666;
      font-style: italic;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    .success {
      color: green;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>
  <h1>Minimal API Test</h1>
  <p>This page tests the API with minimal dependencies.</p>
  
  <div>
    <button id="testYears">Get Available Years</button>
    <button id="testSummary">Get Summary</button>
    <button id="testTrends">Get Trends Data</button>
  </div>
  
  <div id="status" class="loading">Click a button to test the API...</div>
  
  <div id="result"></div>
  
  <script>
    // API URL
    const API_URL = 'http://localhost:8000/api/historical';
    
    // DOM elements
    const statusElement = document.getElementById('status');
    const resultElement = document.getElementById('result');
    
    // Test years endpoint
    document.getElementById('testYears').addEventListener('click', async () => {
      try {
        statusElement.className = 'loading';
        statusElement.textContent = 'Loading years data...';
        
        const response = await fetch(`${API_URL}/years`);
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        const data = await response.json();
        
        statusElement.className = 'success';
        statusElement.textContent = 'Years data loaded successfully!';
        
        // Display years as a simple list
        resultElement.innerHTML = `
          <h2>Available Years</h2>
          <p>Total years: ${data.length}</p>
          <p>Range: ${Math.min(...data)} - ${Math.max(...data)}</p>
          <pre>${JSON.stringify(data, null, 2)}</pre>
        `;
      } catch (error) {
        statusElement.className = 'error';
        statusElement.textContent = `Error: ${error.message}`;
        resultElement.innerHTML = '';
      }
    });
    
    // Test summary endpoint
    document.getElementById('testSummary').addEventListener('click', async () => {
      try {
        statusElement.className = 'loading';
        statusElement.textContent = 'Loading summary data...';
        
        const response = await fetch(`${API_URL}/summary`);
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        const data = await response.json();
        
        statusElement.className = 'success';
        statusElement.textContent = 'Summary data loaded successfully!';
        
        // Display summary data
        resultElement.innerHTML = `
          <h2>Library Summary</h2>
          <p><strong>Library:</strong> ${data.name} (ID: ${data.library_id})</p>
          <p><strong>Years:</strong> ${data.earliest_year} - ${data.latest_year} (${data.total_years} years)</p>
          <h3>Available Metrics</h3>
          <ul>
            ${data.metrics_available.map(metric => `<li>${metric}</li>`).join('')}
          </ul>
        `;
      } catch (error) {
        statusElement.className = 'error';
        statusElement.textContent = `Error: ${error.message}`;
        resultElement.innerHTML = '';
      }
    });
    
    // Test trends endpoint
    document.getElementById('testTrends').addEventListener('click', async () => {
      try {
        statusElement.className = 'loading';
        statusElement.textContent = 'Loading trends data...';
        
        // Use a few common metrics
        const metrics = ['total_circulation', 'visits', 'registered_users'];
        const params = new URLSearchParams();
        metrics.forEach(metric => params.append('metrics', metric));
        
        const response = await fetch(`${API_URL}/trends?${params.toString()}`);
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        const data = await response.json();
        
        statusElement.className = 'success';
        statusElement.textContent = 'Trends data loaded successfully!';
        
        // Create HTML for each metric
        let html = '<h2>Trends Data</h2>';
        
        data.forEach(trend => {
          html += `<h3>${trend.metric}</h3>`;
          
          // Create a table for the data
          html += '<table>';
          html += '<tr><th>Year</th><th>Value</th></tr>';
          
          trend.years.forEach((year, index) => {
            const value = trend.values[index] !== null ? trend.values[index] : 'N/A';
            html += `<tr><td>${year}</td><td>${value}</td></tr>`;
          });
          
          html += '</table>';
          
          // Add growth rates if available
          if (trend.growth_rates) {
            html += '<h4>Growth Rates</h4>';
            html += '<ul>';
            
            if (trend.growth_rates.total !== undefined) {
              html += `<li>Total Growth: ${trend.growth_rates.total.toFixed(2)}%</li>`;
            }
            
            if (trend.growth_rates.average !== undefined) {
              html += `<li>Average Annual Growth: ${trend.growth_rates.average.toFixed(2)}%</li>`;
            }
            
            html += '</ul>';
            
            // Add yearly growth rates if available
            if (trend.growth_rates.yearly && Object.keys(trend.growth_rates.yearly).length > 0) {
              html += '<h4>Yearly Growth Rates</h4>';
              html += '<table>';
              html += '<tr><th>Year</th><th>Growth Rate</th></tr>';
              
              Object.entries(trend.growth_rates.yearly)
                .sort(([yearA], [yearB]) => Number(yearA) - Number(yearB))
                .forEach(([year, rate]) => {
                  html += `<tr><td>${year}</td><td>${Number(rate).toFixed(2)}%</td></tr>`;
                });
              
              html += '</table>';
            }
          }
        });
        
        resultElement.innerHTML = html;
      } catch (error) {
        statusElement.className = 'error';
        statusElement.textContent = `Error: ${error.message}`;
        resultElement.innerHTML = '';
      }
    });
  </script>
</body>
</html> 