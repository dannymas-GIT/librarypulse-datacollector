<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Library Pulse App</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      background-color: #f5f7fa;
      color: #1e293b;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid #e2e8f0;
      margin-bottom: 24px;
    }
    .logo {
      font-size: 24px;
      font-weight: 700;
      color: #1e3a8a;
    }
    .container {
      display: grid;
      grid-template-columns: 250px 1fr;
      gap: 24px;
    }
    .sidebar {
      background-color: white;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .sidebar-nav {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .sidebar-nav li {
      margin-bottom: 8px;
    }
    .sidebar-nav a {
      display: block;
      padding: 8px 12px;
      color: #64748b;
      text-decoration: none;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .sidebar-nav a:hover, .sidebar-nav a.active {
      background-color: #f1f5f9;
      color: #1e3a8a;
    }
    .sidebar-nav a.active {
      font-weight: 600;
    }
    .content {
      background-color: white;
      border-radius: 8px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    h1 {
      margin-top: 0;
      color: #1e3a8a;
    }
    .chart-container {
      margin-top: 24px;
      height: 400px;
      background-color: #f8fafc;
      border-radius: 8px;
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .controls {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
    }
    select, button {
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid #cbd5e1;
      background-color: white;
      font-size: 14px;
    }
    button {
      background-color: #3b82f6;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 500;
    }
    button:hover {
      background-color: #2563eb;
    }
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 400px;
    }
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border-left-color: #3b82f6;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .error {
      color: #ef4444;
      padding: 16px;
      background-color: #fee2e2;
      border-radius: 4px;
      margin-bottom: 16px;
    }
    .years-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 16px;
    }
    .year-tag {
      background-color: #e0f2fe;
      color: #0369a1;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">IMLS Library Pulse</div>
  </header>
  
  <div class="container">
    <div class="sidebar">
      <ul class="sidebar-nav">
        <li><a href="#" class="active">Historical Trends</a></li>
        <li><a href="#">Dashboard</a></li>
        <li><a href="#">Reports</a></li>
        <li><a href="#">Settings</a></li>
      </ul>
    </div>
    
    <div class="content">
      <h1>Historical Trends</h1>
      
      <div id="error-container" class="error" style="display: none;"></div>
      
      <div class="controls">
        <select id="metric-select">
          <option value="total_circulation">Total Circulation</option>
          <option value="visits">Visits</option>
          <option value="registered_users">Registered Users</option>
          <option value="total_programs">Total Programs</option>
        </select>
        
        <select id="chart-type">
          <option value="line">Line Chart</option>
          <option value="bar">Bar Chart</option>
        </select>
        
        <button id="fetch-data">Fetch Data</button>
      </div>
      
      <div id="library-info"></div>
      
      <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
      </div>
      
      <div id="chart-container" class="chart-container">
        <p>Select a metric and click "Fetch Data" to view historical trends</p>
      </div>
    </div>
  </div>
  
  <script>
    // DOM Elements
    const metricSelect = document.getElementById('metric-select');
    const chartTypeSelect = document.getElementById('chart-type');
    const fetchButton = document.getElementById('fetch-data');
    const loadingElement = document.getElementById('loading');
    const chartContainer = document.getElementById('chart-container');
    const errorContainer = document.getElementById('error-container');
    const libraryInfoElement = document.getElementById('library-info');
    
    // API URL
    const API_URL = 'http://localhost:8000/api/historical';
    
    // Event Listeners
    fetchButton.addEventListener('click', fetchData);
    
    // Functions
    async function fetchData() {
      const selectedMetric = metricSelect.value;
      
      try {
        // Show loading
        errorContainer.style.display = 'none';
        loadingElement.style.display = 'flex';
        chartContainer.style.display = 'none';
        
        // Fetch library summary
        const summaryResponse = await fetch(`${API_URL}/summary`);
        const summaryData = await summaryResponse.json();
        
        // Display library info
        displayLibraryInfo(summaryData);
        
        // Fetch available years
        const yearsResponse = await fetch(`${API_URL}/years`);
        const yearsData = await yearsResponse.json();
        
        // Fetch trend data
        const trendResponse = await fetch(`${API_URL}/trends?metrics=${selectedMetric}`);
        const trendData = await trendResponse.json();
        
        // Hide loading
        loadingElement.style.display = 'none';
        chartContainer.style.display = 'flex';
        
        // Display chart
        displayChart(trendData, selectedMetric, chartTypeSelect.value);
        
      } catch (error) {
        // Handle error
        loadingElement.style.display = 'none';
        chartContainer.style.display = 'flex';
        errorContainer.style.display = 'block';
        errorContainer.textContent = `Error: ${error.message}`;
        console.error('Error fetching data:', error);
      }
    }
    
    function displayLibraryInfo(data) {
      const libraryName = data.name || 'Unknown Library';
      const libraryId = data.id || 'Unknown ID';
      const availableYears = data.available_years || [];
      
      const yearsHtml = availableYears.map(year => 
        `<span class="year-tag">${year}</span>`
      ).join('');
      
      libraryInfoElement.innerHTML = `
        <h3>${libraryName}</h3>
        <p>Library ID: ${libraryId}</p>
        <p>Available Years:</p>
        <div class="years-list">
          ${yearsHtml}
        </div>
      `;
    }
    
    function displayChart(data, metric, chartType) {
      // In a real app, we would use a charting library here
      // For this simple version, we'll just display the data
      
      const metricLabel = getMetricLabel(metric);
      const years = Object.keys(data).sort();
      const values = years.map(year => data[year][metric] || 0);
      
      let chartHtml = '';
      
      if (chartType === 'line') {
        chartHtml = `
          <h3>Line Chart: ${metricLabel} Over Time</h3>
          <p>Years: ${years.join(', ')}</p>
          <p>Values: ${values.join(', ')}</p>
          <p>This is a placeholder for a line chart visualization</p>
        `;
      } else {
        chartHtml = `
          <h3>Bar Chart: ${metricLabel} Over Time</h3>
          <p>Years: ${years.join(', ')}</p>
          <p>Values: ${values.join(', ')}</p>
          <p>This is a placeholder for a bar chart visualization</p>
        `;
      }
      
      chartContainer.innerHTML = chartHtml;
    }
    
    function getMetricLabel(metric) {
      const labels = {
        total_circulation: 'Total Circulation',
        visits: 'Visits',
        registered_users: 'Registered Users',
        total_programs: 'Total Programs'
      };
      
      return labels[metric] || metric;
    }
    
    // Initial fetch on page load
    document.addEventListener('DOMContentLoaded', () => {
      console.log('Simple app loaded successfully');
    });
  </script>
</body>
</html> 